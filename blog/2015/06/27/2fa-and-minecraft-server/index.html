
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>2FA and Minecraft Server - Toger Blog</title>
  <meta name="author" content="Jason Martin jhmartin@toger.us">

  
  <meta name="description" content="Two Factor Authentication (2FA) is an additional layer of protection you can add to your Minecraft server. You should already be relying on SSH keys &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="E6g-RygMY6w5OqT7qnwKg3eJJnGYWWhMysZEcgihuB8" />

  
  <link rel="canonical" href="http://site.toger.us/blog/2015/06/27/2fa-and-minecraft-server">
  <link href="/site/favicon.png" rel="icon">
  <link href="/site/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/site/atom.xml" rel="alternate" title="Toger Blog" type="application/atom+xml">
  <script src="/site/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/site/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-50432157-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/site/">Toger Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/site/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:site.toger.us" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/site/">Blog</a></li>
  <li><a href="/site/blog/archives">Archives</a></li>
  <li><a href="/site/gpg-pgp-key">GPG/PGP Key</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">2FA and Minecraft Server</h1>
    
    
      <p class="meta">
        








  



<time datetime="2015-06-27T14:57:41-07:00" pubdate data-updated="true">Jun 27<sup>th</sup>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Two Factor Authentication (2FA) is an additional layer of protection you can add to your Minecraft server. You should already be relying on SSH keys to access your server, but those keys can be lost or leaked if you use them on untrusted machines.  2FA protects you from hacks resulting from someone gaining access to your password or SSH key.</p>

<p><a href="http://DuoSecurity.com">DuoSecurity</a> is a company that provides a 2FA service that is free for personal use. A Mobile Push notification is sent via their Android / iOS app whenever a login is attempted and requires an affirmative response before login can proceed.  There is also SMS and computer-generated voice calls, but those consume credits that have a cost to refill. There is also a cost for going over 10 users, which should not be an issue for adminstation of a Minecraft server.</p>

<p>I performed a source install to get the latest version, there are also packages for RHEL/CentOS/Debian/Ubuntu on their website.</p>

<p>They offer a SSH-specific installation and a PAM installation that covers all auth on the machine. PAM is likely the more comprehensive solution but is a more involved process, plus requires a SELinux policy update (and the server resulting from this series has SELinux enabled). Their website tells you how to install the relevant SELinux policy but the necessary objects are missing from their download. I&rsquo;ve send them a mail and will update if I get clarification. For the record, the error I got was:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make: Entering directory `/home/centos/duo_unix-1.9.14/pam_duo'
</span><span class='line'>checkmodule -M -m -o authlogin_duo.mod authlogin_duo.te
</span><span class='line'>checkmodule:  loading policy configuration from authlogin_duo.te
</span><span class='line'>checkmodule:  unable to open authlogin_duo.te
</span><span class='line'>make: [semodule] Error 1 (ignored)
</span><span class='line'>semodule_package -o authlogin_duo.pp -m authlogin_duo.mod
</span><span class='line'>semodule_package:  Could not open file No such file or directory:  authlogin_duo.mod
</span><span class='line'>make: [semodule] Error 1 (ignored)
</span><span class='line'>semodule -i authlogin_duo.pp
</span><span class='line'>semodule:  Failed on authlogin_duo.pp!
</span><span class='line'>make: [semodule] Error 1 (ignored)
</span><span class='line'>make: Leaving directory `/home/centos/duo_unix-1.9.14/pam_duo'</span></code></pre></td></tr></table></div></figure>


<p>SSH setup is straightforward. Install the DuoSecurity app on your mobile device. Create an account on their website. Navigate their portal and select Applications, then <code>+New Application</code>.  Give it name of Minecraft SSH. This will result in a window showing a Integration key, Secret key (requiring a click to show), and an API hostname. Collect those and store them to the side (securely!)</p>

<p><a href="https://www.duosecurity.com/docs/duounix#instructions">https://www.duosecurity.com/docs/duounix#instructions</a> describes the compile process:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget https://dl.duosecurity.com/duo_unix-latest.tar.gz
</span><span class='line'>tar zxf duo_unix-latest.tar.gz
</span><span class='line'><span class="nb">cd </span>duo_unix-1.9.14
</span><span class='line'>./configure --prefix<span class="o">=</span>/usr <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>After installing the binaries, modify /etc/duo/login_duo.conf and fill in the ikey/skey/host values from above. Uncomment pushinfo as well so that more details about the login are sent to you.</p>

<p><a href="https://www.duosecurity.com/docs/duounix#centos">https://www.duosecurity.com/docs/duounix#centos</a> describes modifying SSH to work with the new system. <strong>Keep an alternate root-logged in session open in an alternate window</strong> while attempting this so you can back out if you make a mistake.  Do not log out of the &lsquo;backup&rsquo; window until you&rsquo;ve thoroughly exercised the system. I will not be responsible if you lock yourself out.</p>

<p>Add <code>ForceCommand /usr/sbin/login_duo</code> to the end of /etc/sshd/sshd_config, then restart sshd (which does not kick out existing sessions) with <code>systemctl restart sshd.service</code></p>

<p>Now attempt to log in to your account. You will be prompted to enroll in 2FA. Upon logging in again you will be prompted for your 2FA method, which will look like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span> ssh minecraft.example.com -i ~/.ssh/minecraft.pem -l centos
</span><span class='line'>Duo two-factor login <span class="k">for </span>centos
</span><span class='line'>
</span><span class='line'>Enter a passcode or <span class="k">select </span>one of the following options:
</span><span class='line'>
</span><span class='line'> 1. Duo Push to XXX-XXX-1234
</span><span class='line'> 2. Phone call to XXX-XXX-1234
</span><span class='line'> 3. SMS passcodes to XXX-XXX-1234
</span></code></pre></td></tr></table></div></figure>


<p>I always choose #1 as I do not want to expend credits, though if push failed I could resort to the other two. When I choose #1 I get a popup on my phone asking me to accept / deny the login, and after choosing Accept I am able to log in.</p>

<p>Now I do not have to worry someone will get ahold of my minecraft.pem and gain access to the server. Further, if I get a login-request on my phone and haven&rsquo;t attemped to log in, I know my key has been compromised.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jason Martin jhmartin@toger.us</span></span>

      








  



<time datetime="2015-06-27T14:57:41-07:00" pubdate data-updated="true">Jun 27<sup>th</sup>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/site/blog/categories/minecraft/'>minecraft</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/site/blog/2015/01/27/dsl-modem-and-power-strips/" title="Previous Post: DSL Modem and Power Strips">&laquo; DSL Modem and Power Strips</a>
      
      
        <a class="basic-alignment right" href="/site/blog/2015/06/27/varnish-cache-and-req-dot-backend-dot-healthy/" title="Next Post: Varnish Cache and req.backend.healthy">Varnish Cache and req.backend.healthy &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/site/blog/2018/08/19/dns-as-a-load-balancer/">DNS as a Service Discovery Load Balancer</a>
      </li>
    
      <li class="post">
        <a href="/site/blog/2017/09/24/home-automation-ideas/">Home Automation Ideas</a>
      </li>
    
      <li class="post">
        <a href="/site/blog/2017/06/17/jenkins-and-github-hooks/">Jenkinsfile and Github Hooks</a>
      </li>
    
      <li class="post">
        <a href="/site/blog/2017/04/20/aws-route53-failover-and-alb/">AWS Route53 Failover and ALB</a>
      </li>
    
      <li class="post">
        <a href="/site/blog/2016/06/08/cloud-init-with-centos7-and-chef/">Cloud-Init With CentOS7, Chef, and SELinux</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jhmartin">@jhmartin</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jhmartin',
            count: 21,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/site/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/105964388252097959079?rel=author">
      <img src="//www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Jason Martin jhmartin@toger.us -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>







</body>
</html>
